<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UUIDv7 æ—¥æ™‚ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2em;
        }

        .input-section {
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #555;
            font-weight: 600;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: border-color 0.3s;
            font-family: 'Courier New', monospace;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .result-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .result-item {
            margin-bottom: 15px;
        }

        .result-label {
            font-weight: 600;
            color: #555;
            margin-bottom: 5px;
            display: block;
        }

        .result-value {
            font-size: 18px;
            color: #333;
            font-family: 'Courier New', monospace;
        }

        .error {
            color: #e74c3c;
            padding: 15px;
            background: #fee;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
            margin-top: 20px;
        }

        .spec-section {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
            margin-top: 20px;
        }

        .spec-section h2 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .spec-section h3 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .spec-section p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .spec-section code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
        }

        .spec-section ul {
            margin-left: 20px;
            color: #666;
            line-height: 1.8;
        }

        .spec-section li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” UUIDv7 æ—¥æ™‚ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼</h1>
        
        <div class="input-section">
            <label for="uuid-input">UUIDv7 ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š</label>
            <input 
                type="text" 
                id="uuid-input" 
                placeholder="ä¾‹: 018422b2-4843-7a62-935b-b4e65649de3e"
                autocomplete="off"
            >
        </div>

        <div id="result-container"></div>
    </div>

    <div class="spec-section">
        <h2>UUIDv7 ä»•æ§˜ã«ã¤ã„ã¦</h2>
        
        <h3>æ¦‚è¦</h3>
        <p>
            UUIDv7ã¯ã€RFC 9562ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ã®UUIDãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã™ã€‚
            å…ˆé ­éƒ¨åˆ†ãŒæ™‚åˆ»ã‚’ã‚‚ã¨ã«ä½œæˆã•ã‚Œã‚‹ãŸã‚ã€æ™‚ç³»åˆ—ã‚½ãƒ¼ãƒˆå¯èƒ½ãªç‰¹æ€§ã‚’æŒã¡ã¾ã™ã€‚
        </p>

        <h3>ãƒ‡ãƒ¼ã‚¿æ§‹é€ </h3>
        <p>
            UUIDv7ã¯128ãƒ“ãƒƒãƒˆï¼ˆ16ãƒã‚¤ãƒˆï¼‰ã§æ§‹æˆã•ã‚Œã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã‚’æŒã¡ã¾ã™ï¼š
        </p>
        <ul>
            <li><strong>unix_ts_ms</strong>ï¼ˆ48ãƒ“ãƒƒãƒˆ = 16é€²æ•°12æ¡ï¼‰ï¼šãƒŸãƒªç§’å˜ä½ã®UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—</li>
            <li><strong>ver</strong>ï¼ˆ4ãƒ“ãƒƒãƒˆï¼‰ï¼šãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ï¼ˆv7ã¯ã€Œ7ã€= 0x7ï¼‰</li>
            <li><strong>rand_a</strong>ï¼ˆ12ãƒ“ãƒƒãƒˆï¼‰ï¼šä¹±æ•°</li>
            <li><strong>var</strong>ï¼ˆ2ãƒ“ãƒƒãƒˆï¼‰ï¼šãƒãƒªã‚¢ãƒ³ãƒˆæƒ…å ±ï¼ˆé€šå¸¸ã¯0x2ï¼‰</li>
            <li><strong>rand_b</strong>ï¼ˆ62ãƒ“ãƒƒãƒˆï¼‰ï¼šä¹±æ•°</li>
        </ul>

        <h3>ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</h3>
        <p>
            æ¨™æº–çš„ãªUUIDãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆ8-4-4-4-12ï¼‰ã§è¡¨ç¾ã•ã‚Œã¾ã™ï¼š
        </p>
        <p>
            <code>xxxxxxxx-xxxx-7xxx-xxxx-xxxxxxxxxxxx</code>
        </p>
        <p>
            ã“ã“ã§ã€æœ€åˆã®12æ–‡å­—ï¼ˆãƒã‚¤ãƒ•ãƒ³ã‚’é™¤ãï¼‰ãŒãƒŸãƒªç§’å˜ä½ã®UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¡¨ã—ã¾ã™ã€‚
        </p>

        <h3>æ—¥æ™‚ãƒ‡ã‚³ãƒ¼ãƒ‰æ–¹æ³•</h3>
        <p>
            UUIDv7ã‹ã‚‰æ—¥æ™‚ã‚’å–å¾—ã™ã‚‹ã«ã¯ï¼š
        </p>
        <ol style="margin-left: 20px; color: #666; line-height: 1.8;">
            <li>ãƒã‚¤ãƒ•ãƒ³ã‚’é™¤ã„ãŸå…ˆé ­12æ–‡å­—ã‚’å–å¾—</li>
            <li>16é€²æ•°ã‚’10é€²æ•°ã«å¤‰æ›ã—ã¦ãƒŸãƒªç§’ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å–å¾—</li>
            <li>JavaScriptã®<code>Date</code>ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§æ—¥æ™‚ã«å¤‰æ›</li>
        </ol>

        <h3>ç‰¹å¾´</h3>
        <ul>
            <li>æ™‚ç³»åˆ—ã‚½ãƒ¼ãƒˆå¯èƒ½ï¼šã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ã®ãŸã‚ã€ç”Ÿæˆé †åºãŒä¿æŒã•ã‚Œã‚‹</li>
            <li>ãƒŸãƒªç§’ç²¾åº¦ï¼šã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯ãƒŸãƒªç§’å˜ä½ã§è¨˜éŒ²ã•ã‚Œã‚‹</li>
            <li>ä¸€æ„æ€§ï¼šãƒ©ãƒ³ãƒ€ãƒ éƒ¨åˆ†ã«ã‚ˆã‚Šã€åŒä¸€ãƒŸãƒªç§’å†…ã§ã‚‚ä¸€æ„æ€§ãŒä¿è¨¼ã•ã‚Œã‚‹</li>
            <li>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŠ¹ç‡ï¼šæ™‚ç³»åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦åŠ¹ç‡çš„ã«ä½¿ç”¨ã§ãã‚‹ï¼ˆMySQLã®Bãƒ„ãƒªãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ãŠã„ã¦æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãŒç«¯ã«æŒ¿å…¥ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ãŸã‚ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ·ãã«ããæ€§èƒ½ãŒå‡ºã‚„ã™ã„ã€‚ä¸€æ–¹ã€Firestore ãªã©åˆ†æ•£DBã§ã¯ã‚­ãƒ¼ã¨ã—ã¦ä½¿ã†ã®ã¯ç›¸æ€§ãŒæ‚ªã„ã“ã¨ãŒã‚ã‚‹ï¼‰</li>
        </ul>

        <h3>å‚è€ƒè³‡æ–™</h3>
        <p>
            RFC 9562: UUID Version 7
        </p>
    </div>

    <script>
        const uuidInput = document.getElementById('uuid-input');
        const resultContainer = document.getElementById('result-container');

        function decodeUUIDv7(uuid) {
            // ãƒã‚¤ãƒ•ãƒ³ã‚’é™¤å»
            const uuidWithoutHyphens = uuid.replace(/-/g, '');
            
            // UUIDv7ã®å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆ128ãƒ“ãƒƒãƒˆ = 32æ–‡å­—ã®16é€²æ•°ï¼‰
            if (uuidWithoutHyphens.length !== 32) {
                throw new Error('UUIDã®é•·ã•ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆ32æ–‡å­—ã®16é€²æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰');
            }

            // 16é€²æ•°ã®å½¢å¼ãƒã‚§ãƒƒã‚¯
            if (!/^[0-9a-fA-F]{32}$/.test(uuidWithoutHyphens)) {
                throw new Error('UUIDã¯16é€²æ•°ã®ã¿ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
            }

            // å…ˆé ­12æ–‡å­—ï¼ˆ48ãƒ“ãƒƒãƒˆï¼‰ã‚’å–å¾—
            const timestampHex = uuidWithoutHyphens.substring(0, 12);
            
            // 16é€²æ•°ã‚’10é€²æ•°ã«å¤‰æ›ï¼ˆãƒŸãƒªç§’ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
            const timestampMs = parseInt(timestampHex, 16);
            
            // æ—¥æ™‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
            const date = new Date(timestampMs);
            
            // ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’ç¢ºèªï¼ˆ13æ–‡å­—ç›®ãŒ7ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
            const versionChar = uuidWithoutHyphens.charAt(12);
            const version = parseInt(versionChar, 16);
            
            // if (version !== 7) {
            //    throw new Error(`UUIDv7ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${version}ï¼‰ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³7ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`);
            //}

            return {
                timestampMs: timestampMs,
                date: date,
                timestampHex: timestampHex,
                version: version
            };
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            const milliseconds = String(date.getMilliseconds()).padStart(3, '0');
            
            return {
                dateTime: `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`,
                iso: date.toISOString(),
                unix: Math.floor(date.getTime() / 1000)
            };
        }

        function displayResult(result) {
            const formatted = formatDate(result.date);
            
            resultContainer.innerHTML = `
                <div class="result-section">
                    <div class="result-item">
                        <span class="result-label">æ—¥æ™‚ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰:</span>
                        <div class="result-value">${formatted.dateTime}</div>
                    </div>
                    <div class="result-item">
                        <span class="result-label">æ—¥æ™‚ï¼ˆISO 8601ï¼‰:</span>
                        <div class="result-value">${formatted.iso}</div>
                    </div>
                    <div class="result-item">
                        <span class="result-label">UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆç§’ï¼‰:</span>
                        <div class="result-value">${formatted.unix}</div>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ãƒŸãƒªç§’ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—:</span>
                        <div class="result-value">${result.timestampMs}</div>
                    </div>
                </div>
            `;
        }

        function displayError(message) {
            resultContainer.innerHTML = `
                <div class="error">
                    <strong>ã‚¨ãƒ©ãƒ¼:</strong> ${message}
                </div>
            `;
        }

        function handleInput() {
            const input = uuidInput.value.trim();
            
            if (input === '') {
                resultContainer.innerHTML = '';
                return;
            }

            try {
                const result = decodeUUIDv7(input);
                displayResult(result);
            } catch (error) {
                displayError(error.message);
            }
        }

        // å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        uuidInput.addEventListener('input', handleInput);
        uuidInput.addEventListener('paste', () => {
            setTimeout(handleInput, 10);
        });
    </script>
</body>
</html>